/*
 * Copyright (c) 2018 CA. All rights reserved.
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE file for details.
 */
plugins {
    id "org.sonarqube" version "2.6.2"
    id "com.srcclr.gradle" version "3.0.3" apply false
}

description = 'The gateway-developer-plugin enables developing gateway configuration.'
group 'com.ca.apim.gateway'
tag {
    message {
        "version: ${version} build-date: " + new Date().format('yyyy-MM-dd\'T\'HH:mm:ss')
    }
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'idea'
    apply plugin: 'jacoco'
    apply plugin: "com.srcclr.gradle"
    apply plugin: 'maven-publish'

    group 'com.ca.apim.gateway'
    version = rootProject.version

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    repositories {
        mavenLocal()
        mavenCentral()
    }

    test {
        useJUnitPlatform()
    }

    dependencies {
        testCompile("org.junit.jupiter:junit-jupiter-api:5.2.0")
        testCompile("io.github.glytching:junit-extensions:2.2.0")
        testCompile 'org.mockito:mockito-junit-jupiter:2.19.0'
        testRuntime("org.junit.jupiter:junit-jupiter-engine:5.2.0")
        testCompile 'org.testcontainers:testcontainers:1.4.3'
    }

    //runs tests in parallel
    tasks.withType(Test) {
        maxParallelForks = Runtime.runtime.availableProcessors().intdiv(2) ?: 1
    }

    test {
        testLogging {
            events "passed", "skipped", "failed"
            exceptionFormat "full"
        }
    }

    task sourceJar(type: Jar) {
        from sourceSets.main.allSource
        classifier = 'sources'
    }
}

wrapper {
    gradleVersion = '4.7'
}